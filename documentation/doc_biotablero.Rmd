---
title: "Introducción a BioTablero"
subtitle: "Configuración, despliegue y actualización"
author: 
 - Jerónimo Rodríguez-Escobar^[Temple University, jeronimo.rodriguez@temple.edu]
 - Víctor Hugo Gutiérrez-Vélez^[Temple University]
 - Wilson Lara-Henao^[Temple University]
 - Iván González-Garzón^[Northern Arizona University]
affiliation: Temple University
bibliography: "/Users/sputnik/OneDrive - Temple University/Documentacion_Armonizacion/references_arm.bib"
date: "`r Sys.Date()`"
output:   
 pdf_document:
 toc: true
 number_sections: true
 fig_caption: yes  
 extra_dependencies: ["float"]      
    #includes:  
     #in_header: header.tex
---

# Introducción 

Instucciones para acceder, configurar, dar mantenimiento, integrar y actualizar los componentes del SSD integrado a [**\textcolor{blue}{BioTablero}**](http://biotablero.humboldt.org.co/). *Incluir referencia a aspectos conceptuales **ver después como hago referencia a eso, debería haber un paper*:

BioTablero consta de tres componentes principales que interactúan para recibir, procesar y retornar resultados de consultas de indicadores de biodiversidad, incluyendo las  [**\textcolor{blue}{Variables Esenciales de la Biodiversidad -EBVs}**](https://appliedsciences.nasa.gov/what-we-do/projects/activities-advance-build-and-deliver-remote-sensing-supported-species)  para un área geográfica determinada (*averiguar los términos técnicos correctos para estas operaciones*) 

## Estructura de SSD-BioTablero  
1. Backend
2. Frontend


1. El backend es una *Instance* alojado en [**\textcolor{blue}{Amazon Web Services -AWS}**](https://aws.amazon.com/); el **Back End**.  Recibe y procesa las consultas  enviadas desde el front end por el usuario, y envia los resultados de vueelta al front end para ser desplegados. 
2. Una interfaz gráfica (*Front end*) desarrollada en Shiny, que es la que interactúa con el usuario, recibe las solicitudes y despliega los resultados enviados pòr el back end [**\textcolor{blue}{BioTablero}**](http://biotablero.humboldt.org.co/).

Adicionalmente, hay un contenedor o [**\textcolor{blue}{Docker}**](https://www.docker.com/resources/what-container).  El Docker  empaqueta el código y sus dependencias y como en una sola unidad de software, que permite crear procesos en paralelo, distribuior las cargas y atender múltiples solicitudes simultáneas.

# Configuración y acceso al Backend

El backend es una instancia EC2 alojada en Amazon Web Services que corre en la distribución Ubuntu de Linux. La configuración inicial de las  instancias, las opciones de seguridady la adición de unidades de almacenamiento se describen en detalle en [esta presentación](https://docs.google.com/presentation/d/1qO__YB1htpJsM-TDWzCb9UFaq5wQCcmB9meC-KzNAXk/edit?usp=sharing).

# Acceso a AWS

Al acceder a la cuenta de Biotablero en [**\textcolor{blue}{Amazon Web Services}**](https://aws.amazon.com/)  es posible revisar las especificaciones, la configuración y el estado operacional de la(s) instancia(s). Las credenciales de acceso son:

-Username: biotablerohumboldt@gmail.com
-Password: XXXXXXXX

El vínculo **Instances** muestra las instancias disponibles.  [ventana](insertar imagen acá) 

[**\textcolor{blue}{instanceID}**], muestra detalles adicionales de las instancias. La dirección  pública (Public IPv4 DNS); ej  
```{bash, eval= FALSE}
ec2-3-21-142-154.us-east-2.compute.amazonaws.com  
```
y claves de acceso; *key_biotablero_prod.ppk* (**Windows**) ó  *key_biotablero_prod.pem* (**Linux/MacOS**) son necesarios para establecer la conexión SSH/PuTTY-SSH. 

## Establecer conexión SSH con el servidor virtual


Una vez las instancias están montadas y activas en AWS, el acceso al backend se realiza mediante SSH (Secure Socket Shell) desde la línea de comando de Linux/MacOS o utilizando  [PuTTY],(https://www.sussex.ac.uk/its/services/software/owncomputer/putty), una implementación de SSH para  Windows.  

[**\textcolor{green}{Nota: será necesario describir como se agregan unidades de almacenamiento adicional o con las instrucciones en el ppt es suficiente?}**]

**Aún no se si es mejor exportar esto cmo html o pdf. probablemente lo primero, pero por ahora dejemos así. En todo caso si cambio eso, la sintaxis para cambiar el color de la fuente es de  CSS: span style="color: red;">text</span>** 

### Windows:

1. Descargar e instalar [**\textcolor{blue}{PuTTY}**](putty.org) 
2. Arrancar PuTTY y marcar las opciones como se indica en las imágenes, incluyendo la direccón IPv4 y agregando el archivo con la clave de acceso (key_biotablero_prod.ppk) 
3. Al establecerse la conexión, lo primero que despliega la línea de comando es  **login as:**; escribir *ubuntu*.
*nota, probar si poniendo ubuntu@ec2-3-21-142-154.us-east-2.compute.amazonaws.com  se evita ese último paso*  

### Linux/MacOS

1. Abrir una ventana de la terminal en la carpeta donde está almacenada la clave .ppk o navegar por la línea de comando hasta dicha ubicación.
2. Pegar una línea con la siguiente estructura: 
```{bash, eval=FALSE}
ssh i- "key_instance.pem" username@IPv4
```

Para las instancias de BioTablero se ve así (una sola línea):

```{bash, eval= FALSE}
ssh -i "key_biotablero_prod.pem"
ubuntu@ec2-3-21-142-154.us-east-2.compute.amazonaws.com
```

En la página web de [**\textcolor{blue}{Alaska Satelite Facility}**](https://asf.alaska.edu/how-to/data-recipes/connect-to-ec2-with-ssh-mac-os-x/) incluye u n tutoprial para establecer la conexión con MacOS.


Cuando la conexión es establecida exitosamente, la línea de comando despliega un mensaje  similar a este: 
[instertar imagen](ya.se) *eventualmente agregar caption*


### Almacenamiento

La información que se va a consultar es almacendada en la unidad externa (revisar como se monta en una sección anterior) se almacena en la carpeta /data, que incluye (hoy)"`r Sys.Date()`" los siguientes datasets:


## Transferencia de datos entre las Instances y la máquina local.


## Windows

Dos métodos diferentes:

- Utilizando una interfaz gráfica; WinSCP,  arrastrar y copiar archivos directamente, similar al adminsotrador de archivos de Windows *nota: no lo he hecho aún, lo tengo que probar en la compu del lab pero estoy seguro de qe funciona*

- Utilizando Copia segura de PuTTY (PSCP) desde la línea de comando de Windows (cmd).

### WinSCP

1. Bajar e instalar [**\textcolor{blue}{WinSCP}**](https://winscp.net/eng/download.php) manteniendo las opciones de instalación por defecto.
2. Iniciar WinSCP.
3. En la ventana *Login*, click en *New Site*
4. En el campo *Host Name*, pegar la direccion **IPv4**
5. En el campo *User name*, escribir *ubuntu*.
6. Hacer click en el botón **Advanced**
7. En SSH, hacer clik sobre **Authentication** 
8. En el campo *Private key file*, click sobre el botón **...** y navegar a la carpeta donde la clave de PuTTY (archivo .ppk) está alamcenada, seleccionarlo y aceptar **OK**

*Está configuración puede ser guardada con el botón* **Save** *para usos posteriores.*

9. Dar click sobre el botón **Login**. Se va a desplegar una ventana preguntando si está segure de quere conectarse a un servidor desconocido. **Aceptar**.
10. Si la conexión se establece exitosamente, la ventana WinSCP tiene dos páneles. El izquierdo tiene el sistema de archivos local, el derecho el de la Instancia. Para copiar los archivos basta con hacer *drag and drop*.

### PuTTY Secure Copy (PSCP)

1. Iniciar Windows Command Line (CMD)
2. Asegurarse de que la clave **PuTTy Private Key** (.ppk) esté guardada en la misma carpeta de trabajo o especificar la ruta a la misma. 
3. El comando para trasferir el archivos hacia la instnace tiene esta estructura:
```{bash, eval=FALSE}
C:\> pscp -i yourkey.ppk yourfilename ubuntu@public_DNS:/home/ubuntu/
```
#### Ejemplo: 

Mover el archivo *hansen.zip*, que está almacenado en la carpeta *"Descargas"*, al directorio */home/ubuntu/others* de la Instance.
1. Mover el archivo *key_biotablero_prod.ppk* a la misma carpeta *Descargas* o especificar la ruta completa al mismo.
2. En CMD navegar a la carpeta *Descaragas*: 
```{bash, eval=FALSE}
C:\Users\current_user>cd Downloads
```
Escribir el comando PSCP. Incluye la clave .ppk (con ruta si es necesario), el nombre del archivo que se va transferir, la dfirección IPv4 de la instancia y la ruta al directorio donde se va a almacenar el archivo:
```{bash, eval=FALSE}
C:\> pscp -i key_biotablero_prod.ppk hansen.zip ubuntu@ec2-3-21-142-154.us-east-2.compute.amazonaws.com:/home/ubuntu/others
```
Para transferir datos entre la instancia y la máquina local, el procedimiento es el mismo, invirtiendo las rutas:
```{bash, eval=FALSE}
C:\> pscp -i C:\[path]\key_biotablero_prod.ppk ubuntu@ec2-3-21-142-154.us-east-2.compute.amazonaws.com:/home/ubuntu/others/hansen.zip
```
Referencia: [**\textcolor{blue}{Alaska Satelite Facility}**](https://asf.alaska.edu/how-to/data-recipes/moving-files-into-and-out-of-an-aws-ec2-instance-windows/)

## MacOS/Linux
El procedimiento es similar al de PSCP en Windows;  mediante SCP (*secure copy protocol*) y utlizando la clave .pem en lugar de .ppk.


```{bash, eval=FALSE}
scp -i key_biotablero_prod.pem hansen.zip ubuntu@ec2-3-21-142-154.us-east-2.compute.amazonaws.com:/home/ubuntu/others
```

Referencia: [**\textcolor{blue}{Alaska Satelite Facility}**](https://asf.alaska.edu/how-to/data-recipes/connect-to-ec2-with-ssh-mac-os-x/)
